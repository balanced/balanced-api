scenarios:
  - name: create_card
    request:
      method: POST
      href: /cards
      schema:
        "$ref": "../requests/card.json"
      body: {
        "number": "4111 1111 1111 1111",
        "expiration_month": 12,
        "expiration_year": 2016,
      }
    response:
      schema: 
        "$ref": "../responses/cards.json"
      status_code: 201
      equals: {"cards": [{
        "name": null
        "number": "xxxxxxxxxxxx1111",
        "expiration_month": 12,
        "expiration_year": 2016,
        "cvv": null,
        "cvv_match": null,
        "cvv_result": "Not Processed",
        "address": {
          "line1": null,
          "line2": null,
          "locality": null,
          "region": null,
          "country_code": null
        },
        "avs_street_match": null,
        "avs_postal_match": null,
        "avs_result": "Address not verified.",
        "brand": "Visa",
        "meta": {}
      }]}

  - name: expiration_string
    request:
      method: POST
      href: /cards
      schema:
        "$ref": "../requests/card.json"
      body: {
        "number": "4111 1111 1111 1111",
        "expiration_month": "12",
        "expiration_year": "2016"
      }
    response:
      schema: 
        "$ref": "../responses/cards.json"
      status_code: 201
      equals: {"cards": [{
        "expiration_month": 12,
        "expiration_year": 2016
      }]}

  - name: cardholder_name
    request:
      method: POST
      href: /cards
      schema:
        "$ref": "../requests/card.json"
      body: {
        "name": "Frida Kahlo",
        "number": "4111 1111 1111 1111",
        "expiration_month": 12,
        "expiration_year": 2016
      }
    response:
      schema: 
        "$ref": "../responses/cards.json"
      status_code: 201
      equals: {"cards": [{"name": "Frida Kahlo"}]}

  - name: cardholder_address
    request:
      method: POST
      href: /cards
      schema:
        "$ref": "../requests/card.json"
      body: {
        "number": "4111 1111 1111 1111",
        "expiration_month": 12,
        "expiration_year": 2016,
        "address": {
          "line1": "7 Bis Rue de l'Abbé de l'Épée",
          "line2": "Apt 4",
          "locality": "Versailles",
          "postal_code": "78000",
          "country_code": "FR"
        }
      }
    response:
      schema: 
        "$ref": "../responses/cards.json"
      status_code: 201
      equals: {"cards": [{
        "address": {
          "line1": "7 Bis Rue de l'Abbé de l'Épée",
          "line2": "Apt 4",
          "locality": "Versailles",
          "region": null,
          "postal_code": "78000",
          "country_code": "FR"
        }
      }]}

  - name: fails_luhn
    request:
      method: POST
      href: /cards
      schema:
        "$ref": "../requests/card.json"
      body: {
        "number": "4111 1111 1111 1112",
        "expiration_month": 12,
        "expiration_year": 2016
      }
    response:
      schema: 
        "$ref": "../responses/errors.json"
      status_code: 409

  - name: create_card
    request:
      method: DELETE
      href: "{card,href}"
    response:
      status_code: 204